# Simulation of monatomic water in contact with a flat hydrophilic substrate.
# Load in molecular configuration.
# Equilibrate the water at the starting temperature.
# Cool the water at a rate of 0.25 K/ns.
# Ice nucleation will occur within the capillary bridge at some point during the cooling process.
#
# Notes:
# SEED is a random number that will need to be changed for each simulation run.
# DIR will determine which directory the output files are saved into.
# Adjust the value of PRES to change the pressure in the simulation (ex. 1, -500, -1000)
#
# Start and end temps may also need to be adjusted for different pressure settings
# e.g. 245 to 225 K for -1000atm
#
# The number of STEPS must match the START and END TEMP to ensure the proper cooling rate.
# e.g. 2000000 steps per 5K of cooling
#
# The input capillary data file and potential file (MLC_e.sw) need to be in the same directory as this input file
#
# Run simulation in lammps with the following command (example):
# mpirun ~/lammps/src/lmp_mpi -in in.heterogeneous_cooling
#
# Script written by Elise Rosky
# Last modified Feb 14, 2023


variable        SEED string 12333
variable        NAME string het_freeze_0
variable        DIR string run_0
variable        TEMP string 240
variable        END_TEMP string 220
variable        STEPS string 8000000
variable        PRES string 1
variable        TCOUPL string 5000.0
variable        PCOUPL string 10000.0

units	   	    real
atom_style 	    atomic
log				${DIR}/log.eq_${NAME}


## IMPORT INPUT MOLECULES APPROPRIATE FOR THE PRESSURE SETTING
# read_data data.ML_substrate_m500atm_240K
# read_data data.ML_substrate_m1000atm_245K

read_data data.ML_substrate_1atm_240K
group water type 1
group substrate type 2


## Define interaction potential

pair_style sw
pair_coeff * * MLC_e.sw mW C


## Fix substrate atoms in place

fix 5 substrate setforce 0.0 0.0 0.0
velocity substrate set 0.0 0.0 0.0


## Equilibration of water molecules ##

# Add velocity/set timestep

velocity	    water create ${TEMP} ${SEED} rot yes dist gaussian
timestep	    5.0

# Define outputs

compute		1 water msd
compute		3 water temp
thermo	    	50
thermo_style	custom step temp press vol etotal ke pe c_1[4] c_3

# Neighbor lists

neigh_modify    delay 0 every 1 check yes

# Set equilibration fixes

fix             1 water momentum 10 linear 1 1 1 rescale
fix             2 water nve
fix             3 water temp/csvr ${TEMP} ${TEMP} 500.0 ${SEED}
fix             4 water press/berendsen z ${PRES} ${PRES} 1000.0 modulus 20000

# Run 0.5 ns equilibration

dump		1 all atom 2000 ${DIR}/eq.${NAME}-${TEMP}.dump

reset_timestep  0 
run	        100000

write_data	${DIR}/data.eq-${NAME}-${TEMP}

reset_timestep  0 
undump          1
unfix           2
unfix           3
unfix           4


################################################
#######         Run Simulation         #########
################################################  

log		    ${DIR}/log.run_${NAME}
timestep	    10.0


compute			2 water orientorder/atom nnn NULL cutoff 3.5
dump		    1 water custom 1000 ${DIR}/prod.water.${NAME}-${TEMP}-${END_TEMP}.dump id type x y z vx vy vz c_2[*]
dump		    2 substrate custom 1000 ${DIR}/prod.substrate.${NAME}-${TEMP}-${END_TEMP}.dump id type x y z vx vy vz c_2[*]

# Set production fixes

fix             2 water nph z ${PRES} ${PRES} ${PCOUPL} 
fix             3 water temp/csvr ${TEMP} ${END_TEMP} ${TCOUPL} ${SEED}


# Run simulation

run	            ${STEPS}
write_data		${DIR}/data.end-${NAME}-${TEMP}-${END_TEMP}
